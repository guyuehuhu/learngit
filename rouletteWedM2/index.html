<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
	<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
    <META HTTP-EQUIV="Cache-Control" CONTENT="no-cache"> 
    <META HTTP-EQUIV="Expires" CONTENT="0"> 
    <title>天天有奖</title>
	<link href="css/reset.css" rel="stylesheet">
    <link href="css/index.css" rel="stylesheet">
	<script src="js/sta.js"></script>
</head>
<body>
	<div class="mainContainer">
		<div class="titleContainer">
			<img src="http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/theme1.png" alt="">
		</div>
		<div class="tipsContainer">
			<p>你还有<span class="yellow">3</span>次机会</p>
		</div>
		<div class="dishContainer">
			<img src="http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/1.gif" alt="">
			<div class="rouletteContainer">
				<div id="0" class="blockContainer selected">
					<div class="objectContainer">
						<img src="http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/100m.png" alt="">
						<p>100M免费流量</p>
					</div>
					
				</div>
				<div id="1" class="blockContainer">
					<div class="objectContainer">
						<img src="http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/5.png" alt="">
						<p>5元微信红包</p>
					</div>
				</div>
				<div id="2" class="blockContainer">
					<div class="objectContainer">
						<img src="http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/500.png" alt="">
						<p>出游大礼包</p>
					</div>
				</div>
				<div id="7" class="blockContainer">
					<div class="objectContainer">
						<img src="http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/jia.png" alt="">
						<p>继续加油</p>
					</div>
				</div>
				<div id="begin" class="centralContainer">
					<img src="http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/btn-1.png" alt="">
				</div>
				<div id="3" class="blockContainer">
					<div class="objectContainer">
						<img src="http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/100.png" alt="">
						<p>电影优惠券</p>
					</div>
				</div>
				<div id="6" class="blockContainer">
					<div class="objectContainer">
						<img src="http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/2bag.png" alt="">
						<p>2元话费红包</p>
					</div>
				</div>
				<div id="5" class="blockContainer">
					<div class="objectContainer">
						<img src="http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/vip.png" alt="">
						<p>VIP特权1天</p>
					</div>
				</div>
				<div id="4" class="blockContainer">
					<div class="objectContainer">
						<img src="http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/100fan.png" alt="">
						<p>外卖代金券</p>
					</div>
				</div>
				<div class="clear"></div>
			</div>
	
		</div>
		
		<div class="elseContainer">
			<h2>活动说明</h2>
			<p>1. 关注触宝微信公众号，每天可以参与抽奖3次；</p>
			<p>2. 话费红包将兑换成触宝电话等值免费时长，用于免费拨打国内外手机座机；</p>
			<p>3. VIP特权享有更良好的免费电话通话体验，可避免高峰时段被抢线；</p>
			<p>4. 触宝电话相关奖品可在App内的【个人中心】查看，其他奖品可根据抽中后的提示领取。</p>
			
		</div>
		
	</div>
	<!--div class="footerContainer">
			<p>奖品说明：可在触宝电话App--个人中心查看</p>
	</div-->
	
	<div class="maskContainer" id="fetch">
		
		<div class="kContainer">
			<img src="http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/kuang2.png" alt="">
			<div class="wordContainer">
			    <div class="conContainer">
					<p>恭喜抽中<span id="prizeName">100M免费流量</span></p>
				</div>
				<div class="prizeContainer">
					<img src="http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/2bag.png" alt="">
				</div>
				
				<div class="showContainer">
					<p>奖品于每周五发放到触宝电话账户，请保证中奖手机号已注册</p>
				</div>
				<div id="iknow" class="buttonContainer">
					<img src="http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/btn2.png" alt="">
				</div>
			</div>
			
			<div id="close" class="closeContainer">
				<img src="http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/input_delete.png" alt="">
			</div>
		</div>
		
	</div>
	
	
	
	<div class="maskContainer" id="phone">
		
		<div class="kContainer">
			<img src="http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/kuang.png" alt="">
			<div class="phoneContainer">
				<p>此号码将作为您的中奖唯一凭证</p>
				<input id="q4" type="tel" placeholder="请输入手机号" name="suning"  maxlength=11/>
				<span style="display : block ; text-align : center ; position : relative ; color : white ; font-size : 0.8em ; margin-top : 4px ;"></span>
				<div id="confirmNum" class="buttonContainer">
					<img src="http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/btn.png" alt="">
				</div>
			</div>
		</div>
	</div>
	
	<div class="maskContainer" id="msg">
		
		<div class="kContainer">
			<img src="http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/kuang.png" alt="">
			<div class="wordContainer">
				<div class="showContainer">
						<p id="tips">请明天再来</p>
				</div>
				<div class="moreContainer">
					
					<img src="http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/qidai.png" alt="">
					<!--p>更多丰厚奖品，下周三20:00-24:00不见不散</p-->
				</div>
			</div>
		</div>
	</div>
	
</body>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script type="text/javascript" src="http://cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
<script src="js/web-storage-cache.min.js"></script>
<script src="js/index.js"></script>
<script src="js/time.js"></script>
<script src="js/stois.js"></script>
<script src="js/wx.js"></script>
<script>
     _hmt.push(['_trackEvent', "rouletteWed", "rouletteWedIn"]);
	 
	validate.phone("#q4", "手机号码格式不正确");
	
	$('.yellow').text(timesAlready);
		// alert(times);
	console.log(loadStorage('WedNumber'));
	if( loadStorage('WedNumber') == null ){
		$('#phone').css('display', 'block');

	}
	else{
		myNumber = loadStorage('WedNumber');
		console.log(myNumber);
	}
	
	var roulette = new roulette();
	var myStatus , resultPos , onProcess = false;
	if( loadStorage('WedStatus') !== null ){
		console.log(loadStorage('WedStatus'));
		myStatus = loadStorage('WedStatus');
		if( myStatus == 1){
			$('#iknow img').attr('src', 'http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/btn-3.png');
		}
	}
	var row_id = 0 ;
	var activity_id = 'lucky_wheel_daily';
	document.getElementById('begin').onclick = function(){
	    if( onProcess == true )
		   return ;
	    $('#begin img').attr('src', 'http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/btn-2.png');
		onProcess = true ;
	    var fetchUrl =  'http://dialer-voip.cootekservice.com/voip/wechat_lucky_wheel';
	    // var fetchUrl = 'http://121.52.235.231:40718/voip/wechat_lucky_wheel';
	     console.log(myNumber);
		$.get(fetchUrl,{phone: myNumber, activity_id: activity_id}, function(result){
		    
			console.log(result);
			if( result.result_code == 2000 ){
				 _hmt.push(['_trackEvent', "rouletteWed", "rouletteWedGain"]);
				 row_id = result.result.row_id;
				var myResult = result.result.reward_id ;
				console.log('resultId'+ myResult);
				if( myResult == 1 ){
				     resultPos = 6 ;
					$('#prizeName').text('2元话费红包');
				}
				  
			    else if( myResult == 2 ){
					resultPos = 5 ;
					$('#prizeName').text('触宝VIP');
					$('#fetch .prizeContainer img').attr('src', 'http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/vip.png');
					$('#fetch .showContainer p').css('visibility', 'visible');
					$('#fetch .showContainer p').css('text-align', 'center');
					$('#fetch .showContainer p').html('VIP用户可享受更优质的通话体验</br>领取更多VIP请移步触宝电话-赚钱中心');
				}	
				else{
				    resultPos = 7 ;
					if( myStatus == 1 ){
						$('#fetch .showContainer p').css('visibility', 'visible');
						$('#fetch .showContainer p').text('2元话费红包可用于拨打触宝免费电话');
					}
				}
			}
			else if( result.result_code == 2001 ){
			    _hmt.push(['_trackEvent', "rouletteWed", "rouletteWedGainAlready"]);
				row_id = result.result.row_id;
				resultPos = 7 ;
			}  
			else if( result.result_code == 2002 ){
			    _hmt.push(['_trackEvent', "rouletteWed", "rouletteWedAfter3Times"]);
				resultPos = -1 ;
				row_id = result.result.row_id;
				$('#tips').html('别太贪心哟</br>明天再来~');
			}  
			else{
			    _hmt.push(['_trackEvent', "rouletteWed", "rouletteWedNotFitTime"]);
				resultPos = -1 ;
				$('#tips').text('还没到抽奖时间呢');
				
			}
			if( resultPos >= 0 && timesAlready  ){
			    _hmt.push(['_trackEvent', "rouletteWed", "rouletteWedStartRotate"]);
				 //var resultPos =  parseInt( Math.random()*8 ) ;
				console.log(roulette._startbox);
				var resultPath = resultPos - roulette._startbox +1 + ( 2+ parseInt( Math.random()*2 ))*8;
				roulette._jumpnum = resultPath ;
				console.log(resultPath + " "+ resultPos);
				roulette._endbox = resultPos ;
				roulette.run(function(){
				    if( row_id > 0 ){
						//var myUrl = 'http://121.52.235.231:40718/voip/wechat_lucky_wheel_bonus';
						var myUrl = 'http://dialer-voip.cootekservice.com/voip/wechat_lucky_wheel_bonus';
						$.get(myUrl,{phone: myNumber, activity_id: activity_id , reward_id:result.result.reward_id , row_id : row_id }, function(result1){
							console.log( result1 );
						})
					}
					if( resultPos != 7 ){
						$('#fetch').css('display', 'block');
					}
					onProcess = false ;
					$('#begin img').attr('src', 'http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/btn-1.png');
				});
				timesAlready -- ;
				saveStorage('times', timesAlready);
				$('.yellow').text(timesAlready);
			}
			else{
				$('#msg').css('display' , 'block');
			}
			
			
		
		});
	   
	}
	
	document.getElementById('iknow').onclick = function(){
	   if( myStatus == 0  )  
	      $('#fetch').css('display', 'none');
	   else if( myStatus == 1 ){
		  window.location.href = 'http://a.app.qq.com/o/simple.jsp?pkgname=com.cootek.smartdialer';
	   }
	   else{
			console.log('no status');
	   }
	   _hmt.push(['_trackEvent', "rouletteWed", "rouletteWedIknow"]);
	}
	
	document.getElementById('confirmNum').onclick = function(){
		 if( $('#q4').hasClass('pass') ){
		        _hmt.push(['_trackEvent', "rouletteWed", "rouletteWedGoBind"]);
				var tmp =   $('#q4').val() ;
			    var judgeUrl =  'http://ws2.cootekservice.com/voip/bonus_register';
			   $.get(judgeUrl,{phone: tmp}, function(result){
					 
							if(result.result.status == 1 ){
								_hmt.push(['_trackEvent', "rouletteWed", "rouletteWedGoBindNew"]);
							    
								myStatus = 1 ;
								saveStorage('WedStatus', myStatus);
								$('#iknow img').attr('src', 'http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/btn-3.png');
								//$('#iknow img').attr('src', 'http://zhcn.web.cdn.cootekservice.com/s/rouletteWed/images/btn3.png');
							}
							else if(result.result.status == 0 ){
								 _hmt.push(['_trackEvent', "rouletteWed", "rouletteWedGoBindOld"]);
								
								myStatus = 0 ;
								saveStorage('WedStatus', myStatus);
								$('#fetch .showContainer p').css('visibility', 'hidden');
								
								
							}
						     myNumber = tmp ;
							 saveStorage('WedNumber', myNumber);
							 saveStorage('times', 3);
     	                     timesAlready = 3 ;

							 $('.yellow').text(timesAlready);
							 console.log(loadStorage('WedNumber'));
							 $('#phone').css('display', 'none');
					});
				  
		  }
	}
	document.getElementById('close').onclick = function(){
	     
	      $('#fetch').css('display', 'none');
	  
	     _hmt.push(['_trackEvent', "rouletteWed", "rouletteWedClose"]);
	}
</script>
</html>
